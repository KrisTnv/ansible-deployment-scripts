---

- hosts: all
  become: true
  #Tasks run before anything else in the playbook (No different than normal tasks: !)
  pre_tasks:

  - name: Install updates (RHEL)
    tags: always
    dnf:
      update_only: yes
      update_cache: yes
    when: ansible_distribution == "RedHat"

  - name: Install updates (Ubuntu)
    tags: always
    apt:
      upgrade: dist
      update_cache: yes
    when: ansible_distribution == "Ubuntu"

- hosts: all
  become: true
  vars: 
   password: "{{ user_password }}"

  tasks:

  - name: create hpc user
    tags: always
    user:
      name: hpc
      password: "{{ password | password_hash('sha512') }}"
      shell: /bin/bash
      groups: root

  - name: add ssh key for hpc
    tags: always
    authorized_key:
      user: hpc
      key: "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC3EItqR6d/8YAU211VzswmAPaAqTL57doRFzc9CDf1L6L7+MZYmgedmEwXYIGHFmtpafWzLkdVHLRqtO5TgRVeXhc7opefwWYcwgmOb8RXwMICJ1O0CRhZW8KF3iUhTH5e/Zbi+LSgYVztsHoDY2zEtxuHyNlbQL0gx9XrSVjj8lJkHQ+BpEqcWKd5UXmg3s+SYb2fKlwHozTSgj/BblwmdneIykURqPr6uLz9GnAXLIoynGKJygKwhdHqbana/KYBadLbD/em8nHaravtLAoWslkFXUT2S2r/tuBjZ8EqyaDG0wcw2mPa2lvpPNbjBHI6OljbTCxHQU/HUHFn3BHFCaS2Ou3EOTe3JDhKcHHorg2yUSYfjg0ZLl86FkQllxt+aMtfCf+ViKqbJj+ZYt4Eau0CFDxZDHoLVQa/HFLWW2bdvdnllyT3uyezRS8SfjmQOikr2pwjefC9gBARGxL5BRL/OIfTjvGVPg6c6WkYXG6hMq4PMZkNl47oAcqpDPs= kristiyanslave@kristiyanslave-VirtualBox
"
  - name: add sudoers file for hpc
    tags: always
    copy:
      src: /home/kristiyanslave/Ansible-scripts/files/sudoer_hpc
      dest: /etc/sudoers.d/hpc
      owner: root
      group: root
      mode: 0440
